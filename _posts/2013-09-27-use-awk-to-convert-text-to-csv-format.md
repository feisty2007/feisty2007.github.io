---
layout: post
title: "使用Awk来转换邮政编码文件"
description: ""
category: blog 
tags: [awk]
---
{% include JB/setup %}

###简介

最近从网络上面得到一组邮政编码数据，大致格式如下：
	
	黑龙江 (黑)
	哈尔滨市 150000 肇源县 151300 铁力县 152500 依兰县 154800
	双城县 150100 安达市 151400 伊春市 153000 东宁县 157200
	五常县 150200 兰西县 151500 南岔 153100 讷河县 161300
	阿城县 150300 青冈县 151600 嘉荫县 153200 大庆市 163000
	宾县 150400 明水县 151700 佳木斯市 154000 集贤县 154900

	吉林 (吉)
	长春市 130000 吉林市 132000 安图县 133600 四平市 136000
	农安县 130200 永吉县 132200 敦化市 133700 公主岭市 136100
	德惠县 130300 磐石县 132300 通化市 134000 辽源市 136200
	榆树县 130400 桦甸县 132400 通化县 134100 东丰县 136300

格式大概是：

* 按照省份列出的数据
* 省份数据里面，第一行是省的名称+（+简称+）。
* 省的下面是具体地区的邮编

我想把这些数据导入到Mysql里面去，这样就很方便的查询了。目标是分成地区和省份2个数据表。

1、地区邮政编码的格式如下，以哈尔滨为例：

	序号 地区  邮编    省编号
	1   哈尔滨 150000 1
2、省份数据表

	序号 名称   简称
	1    黑龙江 黑

###解决方法

用awk来完成。

1、地区邮编的Awk整理代码
	
	# 按照空行来分割记录，记录之间的分割符号是换行
	BEGIN { FS = "\n"; RS = ""}
	{
		# print "Privence:" $1 NF

		for(i=2; i<=NF; i++)
		{
    		#以空格来分割地区记录
			n=split($i,t," ")

    		#输出CSV格式
		for(j=1;j<n;j+=2)
			print t[j] "," t[j+1] "," NR
		}
	}
2、省份的Awk整理代码

	BEGIN { FS = "\n"; RS = ""}
	{
		# print "Privence:" $1 NF

		#获取第一行记录即可，一般格式为 黑龙江 (黑)，分割即可
		n=split($1,t," ")
		print NR "," t[1] "," substr(t[2],2,length(t[2])-2)
	}

###最后结果

运行

	awk -f f1.awk >zip_code.csv
 
得到地区的邮政编码CSV文件

运行

	awk -f f2.awk > province.csv

得到省份的CSV文件

然后把数据导入到Mysql里面就可以了。



